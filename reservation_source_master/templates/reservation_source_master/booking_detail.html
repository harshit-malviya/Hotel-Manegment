{% extends 'base.html' %}

{% block content %}
<style>
    .status-badge {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
        display: inline-block;
    }

    .status-confirmed {
        background: #d1ecf1;
        color: #0c5460;
    }

    .status-checked-in {
        background: #d4edda;
        color: #155724;
    }

    .status-checked-out {
        background: #f8d7da;
        color: #721c24;
    }

    .status-canceled {
        background: #f8d7da;
        color: #721c24;
    }

    .status-pending {
        background: #fff3cd;
        color: #856404;
    }

    .payment-badge {
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 11px;
        font-weight: bold;
        display: inline-block;
    }

    .payment-paid {
        background: #d4edda;
        color: #155724;
    }

    .payment-partial {
        background: #fff3cd;
        color: #856404;
    }

    .payment-pending {
        background: #f8d7da;
        color: #721c24;
    }

    .amount-positive {
        color: #dc3545;
        font-weight: bold;
    }

    .amount-zero {
        color: #28a745;
        font-weight: bold;
    }
</style>
<div style="padding: 20px; max-width: 1000px; margin: 0 auto;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
        <h1 style="color: #333; margin: 0;">Booking Details #{{ booking.id }}</h1>
        <div>
            <a href="{% url 'booking-update' booking.id %}"
                style="background: #007bff; color: white; padding: 10px 20px; text-decoration: none; border-radius: 6px; margin-right: 10px;">
                ‚úèÔ∏è Edit
            </a>
            <a href="{% url 'booking-list' %}"
                style="background: #6c757d; color: white; padding: 10px 20px; text-decoration: none; border-radius: 6px;">
                ‚Üê Back to Bookings
            </a>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 30px;">
        <!-- Main Booking Information -->
        <div style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">

            <!-- Guest Information -->
            <div style="margin-bottom: 30px;">
                <h3
                    style="color: #667eea; margin-bottom: 20px; border-bottom: 2px solid #667eea; padding-bottom: 10px;">
                    üë§ Guest Information
                </h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <strong>Name:</strong> {{ booking.guest.full_name }}<br>
                        <strong>Email:</strong> {{ booking.guest.email }}<br>
                        <strong>Phone:</strong> {{ booking.guest.contact_number }}
                    </div>
                    <div>
                        <strong>Guest ID:</strong> {{ booking.guest.guest_id }}<br>
                        <strong>Nationality:</strong> {{ booking.guest.nationality }}<br>
                        <strong>Loyalty Level:</strong> {{ booking.guest.get_loyalty_level_display }}
                    </div>
                </div>
            </div>

            <!-- Room Information -->
            <div style="margin-bottom: 30px;">
                <h3
                    style="color: #667eea; margin-bottom: 20px; border-bottom: 2px solid #667eea; padding-bottom: 10px;">
                    üè® Room Information
                </h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <strong>Room Number:</strong> {{ booking.room.room_number }}<br>
                        <strong>Room Type:</strong> {% if booking.room.room_type %}{{ booking.room.room_type.name }}{%else %}N/A{% endif %}<br>
                        <strong>Floor:</strong> {{ booking.room.floor }}
                    </div>
                    <div>
                        <strong>Bed Type:</strong> {{ booking.room.get_bed_type_display }}<br>
                        <strong>Max Occupancy:</strong> {{ booking.room.max_occupancy }}<br>
                        <strong>View:</strong> {% if booking.room.view %}{{ booking.room.get_view_display }}{% else%}N/A{% endif %}
                    </div>
                </div>
            </div>

            <!-- Stay Details -->
            <div style="margin-bottom: 30px;">
                <h3
                    style="color: #667eea; margin-bottom: 20px; border-bottom: 2px solid #667eea; padding-bottom: 10px;">
                    üìÖ Stay Details
                </h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                    <div>
                        <strong>Check-in Date:</strong><br>
                        {{ booking.check_in_date|date:"F d, Y" }}<br>
                        {% if booking.actual_check_in_time %}
                        <small style="color: #28a745;">‚úì Checked in: {{ booking.actual_check_in_time|date:"M d, Y H:i"
                            }}</small>
                        {% endif %}
                    </div>
                    <div>
                        <strong>Check-out Date:</strong><br>
                        {{ booking.check_out_date|date:"F d, Y" }}<br>
                        {% if booking.actual_check_out_time %}
                        <small style="color: #28a745;">‚úì Checked out: {{ booking.actual_check_out_time|date:"M d, Y H:i"
                            }}</small>
                        {% endif %}
                    </div>
                    <div>
                        <strong>Duration:</strong><br>
                        {{ booking.duration_nights }} night{{ booking.duration_nights|pluralize }}<br>
                        {% if booking.actual_duration_hours %}
                        <small style="color: #666;">Actual: {{ booking.actual_duration_hours|floatformat:1 }}
                            hours</small>
                        {% endif %}
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-top: 15px;">
                    <div>
                        <strong>Adults:</strong> {{ booking.number_of_adults }}
                    </div>
                    <div>
                        <strong>Children:</strong> {{ booking.number_of_children }}
                    </div>
                    <div>
                        <strong>Total Guests:</strong> {{ booking.total_guests }}
                    </div>
                </div>
            </div>

            <!-- Booking Source & Status -->
            <div style="margin-bottom: 30px;">
                <h3
                    style="color: #667eea; margin-bottom: 20px; border-bottom: 2px solid #667eea; padding-bottom: 10px;">
                    üìã Booking Information
                </h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                    <div>
                        <strong>Booking Source:</strong><br>
                        {{ booking.get_booking_source_display }}
                        {% if booking.reservation_source %}
                            <br><small style="color: #666;">via {{ booking.reservation_source.name }}</small>
                        {% endif %}
                    </div>
                    <div>
                        <strong>Status:</strong><br>
                        <span
                            class="status-badge {% if booking.status == 'CONFIRMED' %}status-confirmed{% elif booking.status == 'CHECKED_IN' %}status-checked-in{% elif booking.status == 'CHECKED_OUT' %}status-checked-out{% elif booking.status == 'CANCELED' %}status-canceled{% else %}status-pending{% endif %}">
                            {{ booking.get_status_display }}
                        </span>
                    </div>
                    <div>
                        <strong>Rate Plan:</strong><br>
                        {% if booking.rate_plan %}{{ booking.rate_plan.rate_name }}{% else %}Default Rate{% endif %}
                    </div>
                </div>
                {% if booking.confirmation_number %}
                <div style="margin-top: 15px;">
                    <strong>Confirmation Number:</strong> {{ booking.confirmation_number }}
                </div>
                {% endif %}
            </div>

            <!-- Special Requests & Notes -->
            {% if booking.special_requests or booking.booking_notes %}
            <div style="margin-bottom: 30px;">
                <h3
                    style="color: #667eea; margin-bottom: 20px; border-bottom: 2px solid #667eea; padding-bottom: 10px;">
                    üìù Notes & Requests
                </h3>
                {% if booking.special_requests %}
                <div style="margin-bottom: 15px;">
                    <strong>Special Requests:</strong><br>
                    <div style="background: #f8f9fa; padding: 10px; border-radius: 4px; margin-top: 5px;">
                        {{ booking.special_requests|linebreaks }}
                    </div>
                </div>
                {% endif %}
                {% if booking.booking_notes %}
                <div>
                    <strong>Internal Notes:</strong><br>
                    <div style="background: #fff3cd; padding: 10px; border-radius: 4px; margin-top: 5px;">
                        {{ booking.booking_notes|linebreaks }}
                    </div>
                </div>
                {% endif %}
            </div>
            {% endif %}
        </div>

        <!-- Sidebar -->
        <div>
            <!-- Payment Information -->
            <div
                style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px;">
                <h4 style="color: #667eea; margin-bottom: 15px;">üí∞ Payment Details</h4>
                <div style="margin-bottom: 10px;">
                    <strong>Total Amount:</strong><br>
                    <span style="font-size: 1.5rem; color: #28a745; font-weight: bold;">‚Çπ{{ booking.total_amount}}</span>
                </div>
                <div style="margin-bottom: 10px;">
                    <strong>Advance Payment:</strong><br>
                    ‚Çπ{{ booking.advance_payment }}
                </div>
                <div style="margin-bottom: 10px;">
                    <strong>Remaining Amount:</strong><br>
                    <span class="{% if booking.remaining_amount > 0 %}amount-positive{% else %}amount-zero{% endif %}">
                        ‚Çπ{{ booking.remaining_amount }}
                    </span>
                </div>
                <div style="margin-bottom: 10px;">
                    <strong>Payment Status:</strong><br>
                    <span
                        class="payment-badge {% if booking.payment_status == 'PAID' %}payment-paid{% elif booking.payment_status == 'PARTIAL' %}payment-partial{% else %}payment-pending{% endif %}">
                        {{ booking.get_payment_status_display }}
                    </span>
                </div>
                {% if booking.payment_method %}
                <div>
                    <strong>Payment Method:</strong><br>
                    {{ booking.payment_method }}
                </div>
                {% endif %}
            </div>

            <!-- Action Buttons -->
            <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                <h4 style="color: #667eea; margin-bottom: 15px;">‚ö° Quick Actions</h4>

                {% if booking.can_check_in %}
                <a href="{% url 'booking-check-in' booking.id %}"
                    style="display: block; background: #28a745; color: white; padding: 10px; text-decoration: none; border-radius: 6px; text-align: center; margin-bottom: 10px;"
                    onclick="return confirm('Check in {{ booking.guest.full_name }}?')">
                    üè® Check In
                </a>
                {% endif %}

                {% if booking.can_check_out %}
                <a href="{% url 'booking-check-out' booking.id %}"
                    style="display: block; background: #17a2b8; color: white; padding: 10px; text-decoration: none; border-radius: 6px; text-align: center; margin-bottom: 10px;"
                    onclick="return confirm('Check out {{ booking.guest.full_name }}?')">
                    üö™ Check Out
                </a>
                {% endif %}

                {% if booking.can_cancel %}
                <a href="{% url 'booking-cancel' booking.id %}"
                    style="display: block; background: #dc3545; color: white; padding: 10px; text-decoration: none; border-radius: 6px; text-align: center; margin-bottom: 10px;"
                    onclick="return confirm('Cancel this booking?')">
                    ‚ùå Cancel Booking
                </a>
                {% endif %}

                <a href="{% url 'booking-update' booking.id %}"
                    style="display: block; background: #007bff; color: white; padding: 10px; text-decoration: none; border-radius: 6px; text-align: center; margin-bottom: 10px;">
                    ‚úèÔ∏è Edit Booking
                </a>

                <a href="{% url 'booking-delete' booking.id %}"
                    style="display: block; background: #6c757d; color: white; padding: 10px; text-decoration: none; border-radius: 6px; text-align: center;"
                    onclick="return confirm('Delete this booking permanently?')">
                    üóëÔ∏è Delete Booking
                </a>
            </div>

            <!-- Booking Timeline -->
            <div
                style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-top: 20px;">
                <h4 style="color: #667eea; margin-bottom: 15px;">üìÖ Timeline</h4>
                <div style="font-size: 12px;">
                    <div style="margin-bottom: 8px;">
                        <strong>Created:</strong> {{ booking.created_at|date:"M d, Y H:i" }}
                    </div>
                    <div style="margin-bottom: 8px;">
                        <strong>Last Updated:</strong> {{ booking.updated_at|date:"M d, Y H:i" }}
                    </div>
                    {% if booking.actual_check_in_time %}
                    <div style="margin-bottom: 8px; color: #28a745;">
                        <strong>‚úì Checked In:</strong> {{ booking.actual_check_in_time|date:"M d, Y H:i" }}
                    </div>
                    {% endif %}
                    {% if booking.actual_check_out_time %}
                    <div style="color: #17a2b8;">
                        <strong>‚úì Checked Out:</strong> {{ booking.actual_check_out_time|date:"M d, Y H:i" }}
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}